<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Chat Room</title>
        <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" crossorigin="anonymous"></script>

    </head>
<body>
    <header>
        <h1>Chat Room</h1>
        <p>Welcome to the chat room!</p>
        <p>Communicate with a representative</p>
    </header>
    <ul id ="chat-messages"></ul>
    <input type="text" id="message" placeholder="Enter a message">
    <button id="send-btn">Send</button>

    <h2>Leave session</h2>
    <button id="leave-btn">Leave</button>
</body>
    <script>
        const socket = io();
        const username = sessionStorage.getItem('username') || 'Anonymous';
        socket.emit('user_join', {username});
        socket.on('redirect', (data) =>{
            window.location.href = data.url
        });

        const sendButton = document.getElementById('send-btn');
        const leaveButton = document.getElementById('leave-btn');
        const messageInput = document.getElementById('message');
        const chatMessages = document.getElementById('chat-messages');

        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if(message !== '') {
                socket.emit('new_message', {username, message});
                messageInput.value = '';
            }
            else{
                alert('Please enter a message');
            }
        });

        leaveButton.addEventListener('click', () => {
                socket.disconnect();
                sessionStorage.removeItem('username')
                window.location.href = '/';
        });

        socket.on('chat', (data) => {
            const messageItem = document.createElement('li');
            const now = new Date();
            const time = now.toLocaleTimeString()
            messageItem.textContent = `(${time}) ${data.username}: ${data.message}`;
            chatMessages.appendChild(messageItem);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    </script>

</body>
</html>